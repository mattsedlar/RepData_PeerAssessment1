---
title: "Reproducible Research: Peer Assessment 1"
author: "By Matthew Sedlar"
output: 
  html_document:
    keep_md: true
---

## Overview

This report looks at data from a personal activity monitoring device and contains an exploratory analysis of the data. The device collected data at 5-minute intervals through out the day. The data consists of two months of data from an anonymous individual collected during the months of October and November, 2012, and include the number of steps taken in 5-minute intervals each day.

## Loading and preprocessing the data

### Loading

Let's check if we have a "data" folder in our analysis template. Then we'll upload and unzip the data there.

```{r cache=TRUE, message=FALSE}

# Does a data directory exist? If not, I'll do all the work for you. Don't get up or anything.
if(!file.exists("./data")) { dir.create("./data") }

# The zip file.
fileURL <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"

# Downloading the zip and placing it in the data folder.
download.file(fileURL,"./data/repdata-data-activity.zip", method="curl")

# Unzip and TADA!
unzip("./data/repdata-data-activity.zip", exdir="data")

# Let's get rid of that ugly zip file because I like to keep things clean.
file.remove("./data/repdata-data-activity.zip")

# Last stop: data-ville
data <- read.csv("./data/activity.csv")

```

### Preprocessing

Let's take a peek under the data's hood and see what we're dealing with.

```{r}

str(data)

```

That "date" variable should be in the Date class to make life easier for everyone. I like the transform function because it makes me feel like I'm creating a new Transformers character who has the power to report dates accurately.

```{r message=FALSE}

library(dplyr)

data <- tbl_df(data)

data <- data %>% transform(date = as.Date(date))


```


## What is mean total number of steps taken per day?

Let's create a plot of the overall steps taken per day and then find our mean and median. Let's create a plot with ggplot2 because that's what all the cool kids use. 

```{r warning=FALSE}
library(ggplot2)

ggplot(data = data) + 
  geom_bar(aes(date, steps), stat="identity") +
  ggtitle("Overall Steps Taken Per Day")

```

Then let's find the mean and median. We'll have to sum the number of steps per date to find this. And let's not forget there are a lot of NA values in our data, so we'll use 'na.rm' to exclude them.

```{r}

# a new data frame to show our averages by date
grouped <- data %>% 
  group_by(date) %>% 
  summarize(sum = sum(steps, na.rm=TRUE),average=mean(steps, na.rm=TRUE), median= median(steps,na.rm=TRUE))

# the mean of those averages
avgsteps <- mean(grouped$average, na.rm=TRUE)
avgsteps

# and the median
medsteps <- median(grouped$median, na.rm=TRUE)
medsteps

```

What the mean and median tell me is that there isn't a whole lot of activity during the day, even though the overall steps taken per day look impressive.

## What is the average daily activity pattern?

To explore what I rambled about in the above paragraph, let's look at the daily activity pattern for each day using the five-minute interval identifier. For this, let's create another data frame grouped by interval and summarize the mean across all days for that interval. Then let's plot that sucker.

```{r}

grouped2 <- data %>% group_by(interval) %>% summarize(meansteps=mean(steps, na.rm=TRUE))

# our plot
ggplot(grouped2) + 
  geom_line(aes(interval, meansteps)) + 
  ggtitle("Average Activity During Five-Minute Intervals")

```

It appears there is a spike of activity. Let's figure out which interval that is.

```{r}

grouped2 <- grouped2 %>% arrange(desc(meansteps))

head(grouped2)

```

That would be interval 835.

## Imputing missing values

But wait. You know how I have been ignoring all the NAs in my calculations? That could be a problem.

How many missing values are there in the original data set?

```{r}

mv <- is.na(data$steps)

# In this table, TRUE indicates the number of NAs in the steps column
table(mv)
  
```

We could use the data frame I just produced to fill in the missing values with the averages during that particular 5-minute interval. First, I'll copy the original data frame. Then I'll write a function that compares our copy to the data frame with the averages by interval. When the function is run, it rewrites the NAs with the average for that interval.

```{r}

# Let's copy our original data frame.
completedata <- data

# function to fill in the holes
# function takes two arguments: 
# your df w/ missing values and the df with the means by intervals

fillmv <- function(df,meandf) {
  x <- 1
  while (x <= nrow(df)) {
    # conditional for if value is NA
    if(is.na(df[,1][x])) {
      # the interval the NA sits at
      int <- df[,3][x]
      # match that interval to the corresponding interval in our averages df
      match <- meandf %>% filter(interval == int)
      #grab that average and replace the NA
      avg <- match$meansteps[1]
      df[,1][x] <- avg
      x <- x + 1
    }
    else x <- x + 1
  }
  df
}

# Run the function
completedata <- fillmv(completedata,grouped2)

```

Now let's recreate our first histogram with the total number of steps per day, but this time with all the missing values filled in.

```{r}

ggplot(data = completedata) + 
  geom_bar(aes(date, steps), stat="identity") +
  ggtitle("Overall Steps Taken Per Day")

```

Let's take a look at the mean and median.

```{r}

summary(completedata$steps)

```

It appears that filling in that missing data doesn't really change the mean and median.

## Are there differences in activity patterns between weekdays and weekends?
